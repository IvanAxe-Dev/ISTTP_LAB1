@model IEnumerable<FinancesDomain.Models.Category>

@{
    ViewData["Title"] = "Index";
    var itemNum = 1;
    var colorCodes = Model.Select(c => c.CategoryColorHexCode).ToList();
}


<script src='spectrum.js'></script>
<link rel='stylesheet' href='spectrum.css' />


<h1 style="text-align:center; font-size:50px; margin-bottom:1%;">Your categories</h1>

@if (Model.Count() != 0)
{
    <table class="table">
        <thead class="table-head">
            <tr id="head">
                <th>
                    @Html.DisplayNameFor(model => model.Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.TotalExpences)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.ExpenditureLimit)
                </th>
                <th></th>
            </tr>
        </thead>

        <tbody class="table-content">

            @foreach (var item in Model)
            {
                <tr id=@("category" + itemNum) data-id="@item.Id">
                    <td>
                        <b>@Html.DisplayFor(modelItem => item.Name)</b>
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TotalExpences)
                    </td>
                    <td>
                        <b>@Html.DisplayFor(modelItem => item.ExpenditureLimit)</b>
                    </td>
                    <td>
                        <a class="btn btn-primary" asp-action="NewTransaction" asp-route-id="@item.Id">Add new expenditure</a>
                        <a class="btn btn-warning" asp-action="Edit" asp-route-id="@item.Id">Edit category</a>
                        @* <a class="btn btn-outline-danger btn-red" asp-action="Delete" asp-route-id="@item.Id">Delete category</a> *@
                    </td>
                </tr>
                itemNum++;
            }
        </tbody>
    </table>

}
else
{
    <h1>There is no categories yet :/</h1>
}


<p>

    <a class="btn btn-primary btn-green" asp-action="Create">Add new category</a>
</p>

<script>
    const tableRows = document.querySelectorAll('table tr');
    tableRows.forEach(row => {
        if (row.id != 'head') {
            row.addEventListener('click', () => {
                const id = row.dataset.id;
                // Option 1: Redirect
                window.location.href = `/Categories/Details/${id}`;

                // Option 2: AJAX Call (requires more setup)
                // $.ajax(...)
            });
        }
    });

    window.onload = function () {
        var colorCodes = @Html.Raw(Json.Serialize(colorCodes));

        for (let i = 0; i <= colorCodes.length - 1; i++) {
            const tr = document.getElementById(`category${i + 1}`);
            if (colorCodes[i] !== null) {
                tr.style.backgroundColor = colorCodes[i];
            }
            console.log(tr.style.backgroundColor);
        }

        const tableRows = document.querySelectorAll('table tr');
        const tableCells = document.querySelectorAll('table td');

        // Apply opacity to table rows' background color
        tableRows.forEach(row => {
            if (row.id !== 'head') { // Exclude the table header row
                row.style.backgroundColor = modifyColorWithOpacity(row.style.backgroundColor, 0.7);
            }
        });

        // Apply opacity to table cells' background color
        tableCells.forEach(cell => {
            cell.style.backgroundColor = modifyColorWithOpacity(cell.style.backgroundColor, 0.7);
        });

        // ... (Your existing code for color codes and click events) ...

        // Helper function to modify color with opacity
        function modifyColorWithOpacity(color, opacity) {
            if (color.startsWith('rgb')) { // Handle RGB or RGBA colors
                return color.replace(/\)$/, `, ${opacity})`);
            } else { // Assume other color formats (e.g., hex)
                const colorObj = new Option().style;
                colorObj.color = color;
                return colorObj.color.replace(/\)$/, `, ${opacity})`);
            }
        }
    };

</script>
